# Model on `train`

Set the control parameters.

```{r}
ctrl <- trainControl(method = "cv",
                     number = 10,
                     classProbs = TRUE,
                     savePredictions = TRUE,
                     allowParallel = TRUE)
```

Set the model.

```{r}
library(adabag)
method <- "AdaBag"
```

Set the tuning grid for model `r method`.

```{r, eval = TRUE}
grid <- expand.grid(mfinal = seq(50, 150, 50),
                    maxdepth = seq(4, 16, 4))
```

Fit model over the tuning parameters.

```{r}
cl <- makeCluster(3)
registerDoParallel(cl)
trainingModel <- train(type ~ .,
                       data = select(train, -matches("id")),
                       method = method,
                       trControl = ctrl,
                       tuneGrid = grid)
stopCluster(cl)
```

Evaluate the model on the training dataset.

```{r tuningTraining}
trainingModel
ggplot(trainingModel)
hat <-
  train %>%
  transform(hat = predict(trainingModel, train)) %>%
  select(matches("type|hat"))
postResample(hat$hat, hat$type)
confusionMatrix(hat$hat, hat$type)
varImp(trainingModel)
```

Display the final model.

```{r, eval = FALSE}
trainingModel$finalModel
```
