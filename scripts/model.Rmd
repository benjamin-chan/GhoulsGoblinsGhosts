# Model on `train`

Set the control parameters.

```{r}
ctrl <- trainControl(method = "cv",
                     number = 10,
                     classProbs = TRUE,
                     savePredictions = TRUE,
                     allowParallel = TRUE)
```

Set the model.

```{r}
library(C50)
method <- "C5.0"
```

Set the tuning grid for model `r method`.

```{r, eval = TRUE}
grid <- expand.grid(trials = seq(10, 40, 10),
                    model = c("rules", "tree"),
                    winnow = c(TRUE, FALSE))
```

Fit model over the tuning parameters.

```{r}
cl <- makeCluster(3)
registerDoParallel(cl)
trainingModel <- train(type ~ .,
                       data = select(train, -matches("id")),
                       method = method,
                       trControl = ctrl,
                       tuneGrid = grid)
stopCluster(cl)
```

Evaluate the model on the training dataset.

```{r tuningTraining}
trainingModel
ggplot(trainingModel) + theme_bw()
hat <-
  train %>%
  transform(hat = predict(trainingModel, train)) %>%
  select(matches("type|hat"))
postResample(hat$hat, hat$type)
confusionMatrix(hat$hat, hat$type)
varImp(trainingModel)
```

Display the final model.

```{r, eval = TRUE}
trainingModel$finalModel
```
